<!DOCTYPE html>
<html lang="en">
<head>
  
  <script src="https://kit.fontawesome.com/4db88b2900.js" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Channel customization -Our-Tube</title>
    {% load static %}
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'site.webmanifest'%}">
    <link rel="stylesheet" href="{%static 'userchannelstyle.css'%}">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.12/dist/cropper.min.css">
    <!-- Include Cropper.js library -->
   
  
      <script>
        document.addEventListener("DOMContentLoaded", function() {
        var dropdown = document.getElementById("dropdown");
        var dropdownContent = document.getElementById("dropdown-content");
  
        dropdown.addEventListener("click", function() {
          dropdownContent.style.display = (dropdownContent.style.display === "none") ? "block" : "none";
        });
  
        document.addEventListener("click", function(event) {
          var targetElement = event.target;
          if (!targetElement.closest(".dropdown")) {
            dropdownContent.style.display = "none";
          }
        });
      });
      </script>
      <style>
        @import url('https://fonts.cdnfonts.com/css/youtube-sans');
        </style>
      <link href="https://fonts.cdnfonts.com/css/youtube-sans" rel="stylesheet">
     

</head>
   
<nav class="navbar-testing">
  <div class="logo">
    <a href="{% url 'home' %}"><img src="{% static 'Our-TubeLogo.svg' %}"></a>
  </div> 
  <ul class="navbar-nav">

    <div class="menu-btn">
      <i class="fas fa-bars"></i>
    </div>
     <div class="hudini">  <a href="{% url 'loda' %}" class="vinsmoke"><li>How it Works</li></a></div>
     <div class="hudini">    <a href="{% url 'funding_now' %}" class="vinsmoke"><li><i class="fa fa-search"></i> Funding Now</li></a>  </div>  
      <li></li>
      <li></li>
     <div class="hudini"><a href="{% url 'funding_info' %}"> <button class="donate-btn" style="color: azure; font-weight: bold;"> Start a Project</button></a></div>
       {% if user.is_authenticated %}
       <li>
        <div class="dropdown">
          {% if user.profile.cropped_image_data %}
          <img src="{{ user.profile.cropped_image_data.url }}" alt="Button Image" id="dropdown" style="border-radius: 50%; align-self: center;">
          <div class="dropdown-content" id="dropdown-content">
            <a href="{% url 'user_channel' username=request.user.username %}">Your Channel</a>
            <a href="{% url 'donation_history' %}">Your Donations</a>
            <a href="{% url 'logout'%}">Log Out</a>
          {% else %}
          <img src="{% static 'profilepic.png' %}" alt="Button Image" id="dropdown" style="border-radius: 50%;">
          <div class="dropdown-content" id="dropdown-content">
            <a href="{% url 'user_channel' username=request.user.username %}">Your Channel</a>
            <a href="{% url 'donation_history' %}">Your Donations</a>
            <a href="{% url 'logout'%}">Log Out</a>
          {% endif %}
          </div>
        </div>
     </li>
       {% else %}
       <a href="{% url 'login_user' %}" class="vinsmoke"><li>Login</li></a>
       {% endif %}
       

   </ul>

   <div class="overlay" id="overlay">
    <div class="close-btn">
      <i class="fas fa-times fa-lg"></i>
    </div>
    <div class="menu">
        <a href="{% url 'home' %}"><img src="{% static 'Our-TubeLogo.svg' %}" style="width: 150px; height:auto;"></a>
      
      <a href="{% url 'funding_now' %}" class="fuck" style="color: black;"> Discover <i class="fa fa-search" style="rotate: 90deg;"></i></a> 
      <a href="{% url 'loda' %}" style="color: black;" class="fuck">How it Works<i class="fas fa-book" style="margin-left: 10px;"></i></a>
      {% if user.is_authenticated %}
      <a href="{% url 'logout'%}"  class="fuck" style="color: black;">Log Out</a>
      {% else %}
       <a href="{% url 'login_user' %}"  class="fuck" style="color: black;">Login <i class="fas fa-user" style="margin-left: 10px;"></i></a>
       {% endif %}
     <div style="display: flex; align-items: center; justify-content: center; flex-direction: column;">
    <a href="{% url 'funding_info' %}"> <button class="donate-btn-burger" style="color: azure; font-weight: bold;"> Start a Project</button></a>
    {% if user.is_authenticated %}
    <a href="{% url 'donation_history' %}"> <button class="sign-btn-burger">Donation History</button></a>
    {% else %}
    <a href="{% url 'register_user' %}"> <button class="sign-btn-burger">Sign up</button></a>
    {% endif %}
  </div> 
    </div>
  </div>
</nav>
</header>
<body>


    <nav class="edit-bar">
        <ul class="throatgoat">
            <h1 class="escanor">Customize your channel</h1>
            <a href="{% url 'user_channel' username=request.user.username %}" style="text-decoration: none;">  <li class="litems">View channel</li></a>
        </ul>
    </nav>

    
<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <div class="inshah">
    <h3 style="color: black; margin-bottom: 0;">Profile Picture</h3>
    <p class="bigp">Your profile picture will appear where your channel is presented on Our-Tube, like next to your projects or comments. <strong>Choose file, Crop & Publish!</strong></p>

          <div style="display: flex; flex-direction: row; gap: 2vw;">
            <img id="preview-image" src="
            {% if user.profile.cropped_image_data %}
            {{ user.profile.cropped_image_data.url }}
              {% else %}
              {% static 'profilepic.png' %}{% endif %}" class="pfp"> 
                <div style="display: flex; flex-direction: column">
            <p class="pewds"> It is reccomended to use a picture that's at least 98 x 98 pixels and 4mb or less. Use a PNG or GIF (no animations) file. Make sure your picture follows
            the Our-Tube community guidelines. </p>
            <form method="POST" enctype="multipart/form-data" action="{% url 'channel_customization' %}">{% csrf_token %}
                <div class="bignem">
                 
                  {{form.profile_pic}}
                  <input type="hidden" id="cropped-image-data" name="cropped_image_data">
                  <button type="submit" name="submit_profile_pic" class="pubutton">PUBLISH</button>
                </form>
      
            </div>
          
                 </div>

              
            </div>
         
  </div>
        
            <div class="inshah">
              <h3 style="color: black; margin-bottom: 0;">Channel Bio</h3>
             
              <p class="bigp">Enter a description of your channel that can be up to 150 characters long. This will sit at the very top of your channel page next to your profile picture.</p>
              <form method="POST" action="{% url 'channel_customization' %}">{% csrf_token %}  
                <div style="display: flex; flex-direction: column; align-items: center; margin: auto; gap: 10px; margin:0 2%;">   
                {{ form.bio }} 
           
              <button type="submit" name="submit_bio" class="pubutton">PUBLISH</button>
            </div>
          
            </form>
            </div>
         
                        
                
           </div>
  

 
</form>

<div id="cropping-modal" class="modal">
  <div class="modal-content">
    <img id="cropping-preview" src="{% if form.profile_pic.value %}{{ form.profile_pic.value.url }}{% else %}{% if user.profile.profile_pic %}{{ user.profile.profile_pic.url }}{% else %}{% static 'profilepic.png' %}{% endif %}{% endif %}" alt="Cropping Preview" class="toosexy">
    <button id="crop-button" class="crop-button">Crop</button>
  </div>
</div>

<!-- Cropping Preview -->


<!-- Cropping Preview -->

<input type="hidden" id="cropped-image-data" name="cropped_image_data">

<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.12/dist/cropper.min.js"></script>
<script>
  // Select the file input element
  const fileInput = document.getElementById('id_profile_pic');

  // Select the cropping preview image element
  const croppingPreview = document.getElementById('cropping-preview');

  // Select the crop button element
  const cropButton = document.getElementById('crop-button');

  // Create a FileReader instance
  const reader = new FileReader();

  // Initialize Cropper.js on the cropping preview image element
  let cropper;

  // Add an event listener for the file selection
  fileInput.addEventListener('change', function(event) {
    // Get the selected file
    const file = event.target.files[0];

    // Read the selected file as a data URL
    reader.readAsDataURL(file);
  });

  // Add an event listener for the file reader's "load" event
  reader.addEventListener('load', function(event) {
    // Update the cropping preview image source with the loaded file
    croppingPreview.src = event.target.result;
    
    // Show the cropping modal
    showModal();

    // Re-initialize Cropper.js on the updated image element
    if (cropper) {
      cropper.destroy();
    }
    cropper = new Cropper(croppingPreview, {
      aspectRatio: 1, // Set the aspect ratio to maintain a square crop
      viewMode: 1, // Set the view mode to restrict the cropping area to the image size
      autoCrop: true, // Enable automatic cropping
      crop: function(event) {
        // Handle crop event if needed
      }
    });
  });

  // Add a click event listener to the crop button
  cropButton.addEventListener('click', function() {
    // Get the cropped image data from the cropping library
    const croppedImageData = cropper.getCroppedCanvas().toDataURL();

    // Update the hidden input field with the cropped image data
    document.getElementById('cropped-image-data').value = croppedImageData;

    // Hide the cropping modal
    hideModal();

    // Update the preview image with the cropped image data
    const previewImage = document.getElementById('preview-image');
    previewImage.src = croppedImageData;
  });

  // Function to show the cropping modal
  function showModal() {
    const modal = document.getElementById('cropping-modal');
    modal.style.display = 'block';
  }

  // Function to hide the cropping modal
  function hideModal() {
    const modal = document.getElementById('cropping-modal');
    modal.style.display = 'none';
  }
</script>


<script>
  document.querySelector(".menu-btn").addEventListener("click", function () {
    document.getElementById("overlay").style.display = "block";
  });
  
  document.getElementById("overlay").addEventListener("click", function (event) {
    if (event.target.classList.contains("overlay")) {
      document.getElementById("overlay").style.display = "none";
    }
  });
  
  document.querySelector(".close-btn").addEventListener("click", function () {
    document.getElementById("overlay").style.display = "none";
  });
  </script>

</body>
</html>